!########################################################################
!PROGRAM  : PROGRESS
!TYPE     : module
!PURPOSE  : Build and print a progress bar for intensive do-loop
!AUTHORS  : From Internet/ Adriano Amaricci
!########################################################################
module PROGRESS_BAR
  implicit none
  private
  public :: print_bar

contains
  !+-------------------------------------------------------------------+
  !PROGRAM  : 
  !TYPE     : Subroutine
  !PURPOSE  : 
  !+-------------------------------------------------------------------+
  subroutine print_bar(i,imax)
    integer :: i,imax
    call delete_bar(i,imax)
    call plot_bar(i,imax)
    if(i==imax)call close_bar
  end subroutine print_bar
  !*********************************************************************
  !*********************************************************************
  !*********************************************************************

  !+-------------------------------------------------------------------+
  !PROGRAM  : 
  !TYPE     : Subroutine
  !PURPOSE  : 
  !+-------------------------------------------------------------------+
  subroutine print_percent(i,imax)
    integer :: i,imax
    call delete_percent(i,imax)
    call plot_percent(i,imax)
  end subroutine print_percent
  !*********************************************************************
  !*********************************************************************
  !*********************************************************************




  !+-------------------------------------------------------------------+
  !PROGRAM  : 
  !TYPE     : Subroutine
  !PURPOSE  : 
  !+-------------------------------------------------------------------+
  subroutine plot_bar(i,imax)
    integer :: i,imax,k
    character(len=1) :: bar
    bar = "="
    write(*,'(2x,1i9,2x,1i3,1a1,2x,1a1,256a1)', advance='no') &
         i,100*i/imax,'%','|', (bar, k =1,50*i/imax)
  end subroutine plot_bar
  !*********************************************************************
  !*********************************************************************
  !*********************************************************************

  !+-------------------------------------------------------------------+
  !PROGRAM  : 
  !TYPE     : Subroutine
  !PURPOSE  : 
  !+-------------------------------------------------------------------+
  subroutine delete_bar(i,imax)
    integer :: i,imax,k
    character(len=1) :: back
    back = char(8)
    write(*,'(256a1)', advance='no') (back, k =1,(50*i/imax)+9+11)
  end subroutine delete_bar
  !*********************************************************************
  !*********************************************************************
  !*********************************************************************

  !+-------------------------------------------------------------------+
  !PROGRAM  : 
  !TYPE     : Subroutine
  !PURPOSE  : 
  !+-------------------------------------------------------------------+
  subroutine close_bar
    write(*,'(a)') '| done.'
    write(*,*)""
  end subroutine close_bar
  !*********************************************************************
  !*********************************************************************
  !*********************************************************************




  !+-------------------------------------------------------------------+
  !PROGRAM  : 
  !TYPE     : Subroutine
  !PURPOSE  : 
  !+-------------------------------------------------------------------+
  subroutine plot_percent(i,imax)
    integer :: i,imax,k
    write(*,'(2x,1i3,256a1)', advance='no')100*i/imax,'%'
  end subroutine plot_percent
  !*********************************************************************
  !*********************************************************************
  !*********************************************************************

  !+-------------------------------------------------------------------+
  !PROGRAM  : 
  !TYPE     : Subroutine
  !PURPOSE  : 
  !+-------------------------------------------------------------------+
  subroutine delete_percent(i,imax)
    integer :: i,imax,k
    character(len=1) :: back
    back = char(8)
    write(6,'(256a1)', advance='no') (back, k =1,6)
  end subroutine delete_percent
  !*********************************************************************
  !*********************************************************************
  !*********************************************************************



  !+-------------------------------------------------------------------+
  !PROGRAM  : 
  !TYPE     : Subroutine
  !PURPOSE  : 
  !+-------------------------------------------------------------------+
  subroutine print_clockbar(i,imax)
    integer :: i,imax,k,percent
    character(len=1) :: bar
    write(*,'(100a)', advance='no') (char(8), k=1,1+5)
    percent=100*i/imax
    k=mod(percent,20)
    if(k==0.or.k==1.or.k==2.or.k==3)bar='| '
    if(k==4.or.k==5.or.k==6.or.k==7)bar='/ '
    if(k==8.or.k==9.or.k==10.or.k==11)bar='- '
    if(k==12.or.k==13.or.k==14.or.k==15)bar='\ '
    if(k==16.or.k==17.or.k==18.or.k==19)bar='| '
    write(*,'(1x,i3,1x,a1)', advance='no') percent,bar
    if(i==imax)then
       write(*,'(a)', advance='no') char(8)
       write(*,'(a)')"done"
    endif
  end subroutine print_clockbar
  !*********************************************************************
  !*********************************************************************
  !*********************************************************************
end module PROGRESS_BAR

